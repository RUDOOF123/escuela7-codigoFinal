<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Biblioteca Escolar</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .preview {
      margin-top: 10px;
      max-width: 100%;
      height: 300px;
      border: 1px solid #ccc;
      border-radius: 5px;
      object-fit: contain;
    }
  </style>
</head>
<body class="bg-light">

  <div class="container py-5">
    <h1 class="text-center mb-4">ðŸ“š Biblioteca Escolar</h1>

    <div class="card mb-5">
      <div class="card-body">
        <h5 class="card-title">Subir nuevo archivo</h5>
        <div class="input-group">
          <input type="file" class="form-control" id="fileInput">
          <button class="btn btn-success" onclick="uploadFile()">Subir</button>
        </div>
      </div>
    </div>

    <div id="fileList" class="row g-4">
      <!-- Archivos cargados se mostrarÃ¡n aquÃ­ -->
    </div>
  </div>

  <script>
    const API_URL = 'http://localhost:3000';

    async function fetchFiles() {
      const res = await fetch(`${API_URL}/files`);
      const files = await res.json();

      const list = document.getElementById('fileList');
      list.innerHTML = '';

      if (!Array.isArray(files)) {
        list.innerHTML = '<div class="alert alert-danger">No se pudieron cargar los archivos.</div>';
        return;
      }

      files.forEach(file => {
        const col = document.createElement('div');
        col.className = 'col-md-6';

        const card = document.createElement('div');
        card.className = 'card shadow-sm';

        const cardBody = document.createElement('div');
        cardBody.className = 'card-body';

        const name = document.createElement('h5');
        name.className = 'card-title';
        name.textContent = file.name;

        const preview = document.createElement('div');
        preview.className = 'mb-3';

        if (file.name.endsWith('.pdf')) {
          preview.innerHTML = `<embed class="preview w-100" src="${API_URL}/download/${file.id}" type="application/pdf" />`;
        } else if (file.name.match(/\.(jpg|jpeg|png|gif)$/i)) {
          preview.innerHTML = `<img class="preview" src="${API_URL}/download/${file.id}" alt="${file.name}" />`;
        } else {
          preview.innerHTML = `<div class="placeholder-glow"><span class="placeholder col-6 bg-secondary"></span></div>`;
        }

        const button = document.createElement('a');
        button.className = 'btn btn-outline-primary';
        button.textContent = 'ðŸ“¥ Descargar';
        button.href = `${API_URL}/force-download/${file.id}`;
        button.target = '_blank';

        cardBody.appendChild(name);
        cardBody.appendChild(preview);
        cardBody.appendChild(button);
        card.appendChild(cardBody);
        col.appendChild(card);
        list.appendChild(col);
      });
    }

    async function uploadFile() {
      const input = document.getElementById('fileInput');
      const file = input.files[0];
      if (!file) return alert('SeleccionÃ¡ un archivo');

      const formData = new FormData();
      formData.append('file', file);

      const res = await fetch(`${API_URL}/upload`, {
        method: 'POST',
        body: formData,
      });

      if (res.ok) {
        alert('Archivo subido con Ã©xito');
        input.value = '';
        fetchFiles(); // actualizar lista
      } else {
        alert('Error al subir archivo');
      }
    }

    window.onload = fetchFiles;
  </script>

</body>
</html>





